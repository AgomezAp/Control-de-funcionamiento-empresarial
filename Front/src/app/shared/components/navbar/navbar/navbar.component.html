<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo Section -->
    <div class="navbar-brand">
      <a routerLink="/dashboard" class="brand-link">
        <div class="brand-icon">
          <i class="pi pi-box"></i>
        </div>
        <span class="brand-text">Gestión Peticiones</span>
      </a>
    </div>

    <!-- Search Section -->
    <div class="navbar-search">
      <div class="search-wrapper">
        <i class="pi pi-search search-icon"></i>
        <input
          #searchInput
          type="text"
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          (focus)="showSearchResults = true"
          (keydown)="onSearchKeyDown($event)"
          placeholder="Buscar... (Ctrl+K)"
          class="search-input"
        />
        <button
          *ngIf="searchQuery"
          pButton
          type="button"
          icon="pi pi-times"
          class="p-button-text p-button-sm clear-search-btn"
          (click)="clearSearch()"
        ></button>
        <kbd class="search-shortcut">
          <span>Ctrl</span>
          <span>K</span>
        </kbd>
      </div>
      
      <!-- Search Results Dropdown -->
      <div
        *ngIf="showSearchResults && searchQuery && filteredResults.length > 0"
        class="search-results"
        (clickOutside)="showSearchResults = false"
      >
        <div class="search-results-header">
          <span>Resultados de búsqueda</span>
          <span class="results-count">{{ filteredResults.length }}</span>
        </div>
        <div class="search-results-list">
          <div
            *ngFor="let result of filteredResults; let i = index"
            class="search-result-item"
            [class.selected]="selectedResultIndex === i"
            (click)="navigateToResult(result)"
            (mouseenter)="selectedResultIndex = i"
          >
            <div class="result-icon">
              <i [class]="result.icon"></i>
            </div>
            <div class="result-content">
              <span class="result-title">{{ result.title }}</span>
              <span class="result-category">{{ result.category }}</span>
            </div>
            <i class="pi pi-arrow-right result-arrow"></i>
          </div>
        </div>
      </div>
      
      <!-- No Results Message -->
      <div
        *ngIf="showSearchResults && searchQuery && filteredResults.length === 0"
        class="search-results no-results"
        (clickOutside)="showSearchResults = false"
      >
        <div class="no-results-content">
          <i class="pi pi-search"></i>
          <p>No se encontraron resultados para "{{ searchQuery }}"</p>
        </div>
      </div>
    </div>

    <!-- Actions Section -->
    <div class="navbar-actions">
      <!-- Theme Toggle - MEJORADO -->
      <div class="action-item theme-toggle-wrapper">
        <button
          pButton
          type="button"
          class="action-btn theme-btn"
          (click)="toggleTheme()"
          [pTooltip]="
            (isDarkMode$ | async)
              ? 'Cambiar a modo claro'
              : 'Cambiar a modo oscuro'
          "
          tooltipPosition="bottom"
        >
          <i class="pi pi-sun theme-icon" *ngIf="isDarkMode$ | async"></i>
          <i class="pi pi-moon theme-icon" *ngIf="!(isDarkMode$ | async)"></i>
        </button>
      </div>

      <!-- Notifications - MEJORADO -->
      <div class="action-item notification-wrapper">
        <button
          pButton
          type="button"
          class="action-btn notification-btn"
          (click)="openNotifications()"
          pTooltip="Ver notificaciones"
          tooltipPosition="bottom"
          [class.has-notifications]="
            (unreadCount$ | async) && (unreadCount$ | async)! > 0
          "
        >
          <i class="pi pi-bell bell-icon"></i>
          <span
            *ngIf="(unreadCount$ | async) && (unreadCount$ | async)! > 0"
            class="notification-badge"
          >
            {{ (unreadCount$ | async)! > 99 ? "99+" : (unreadCount$ | async) }}
          </span>
        </button>
      </div>

      <!-- User Menu - MEJORADO -->
      <div class="action-item user-menu-wrapper">
        <div class="user-menu" (click)="menu.toggle($event)">
          <div class="user-avatar-container">
            <div class="user-avatar">
              <span class="avatar-text">{{
                currentUser?.nombre_completo | initials
              }}</span>
            </div>
            <span class="user-status"></span>
          </div>
          <div class="user-info">
            <span class="user-name">{{ currentUser?.nombre_completo }}</span>
            <span class="user-role">
              <i class="pi pi-briefcase"></i>
              {{ currentUser?.rol || "Usuario" }}
            </span>
          </div>
          <i class="pi pi-chevron-down dropdown-icon"></i>
        </div>

        <p-menu
          #menu
          [model]="userMenuItems"
          [popup]="true"
          styleClass="user-dropdown-menu"
        ></p-menu>
      </div>
    </div>
  </div>
</nav>
