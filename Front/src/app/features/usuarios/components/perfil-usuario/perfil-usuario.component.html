<div class="container-perfil">
  <app-loader *ngIf="cargando"></app-loader>

  <div *ngIf="!cargando" class="content-wrapper">
    <div class="perfil-card">
      <!-- Header -->
      <div class="card-header">
        <h2 class="header-title">
          <i class="pi pi-user" style="color: #4caf50"></i>
          <span>Perfil de Usuario</span>
        </h2>
        <div class="header-actions">
          <button
            class="btn btn-edit"
            type="button"
            (click)="editar()"
            *ngIf="usuario"
          >
            <i class="pi pi-pencil"></i>
            <span>Editar</span>
          </button>
          <button class="btn btn-back" type="button" (click)="volver()">
            <i class="pi pi-arrow-left"></i>
            <span>Volver</span>
          </button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs-container" *ngIf="usuario">
        <div class="tabs-header">
          <button
            class="tab-button"
            [class.active]="activeTabIndex === 0"
            (click)="activeTabIndex = 0"
          >
            <i class="pi pi-user"></i>
            <span>Información Personal</span>
          </button>
        </div>

        <!-- Tab Content: Información Personal -->
        <div class="tab-content" *ngIf="activeTabIndex === 0">
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">
                <i class="pi pi-user" style="color: #ffd700"></i>
                Nombre Completo
              </label>
              <p class="info-value">{{ usuario.nombre_completo }}</p>
            </div>

            <div class="info-item">
              <label class="info-label">
                <i class="pi pi-envelope" style="color: #2196f3"></i>
                Correo Electrónico
              </label>
              <p class="info-value">{{ usuario.correo }}</p>
            </div>

            <div class="info-item">
              <label class="info-label">
                <i class="pi pi-check-circle" style="color: #4caf50"></i>
                Estado
              </label>
              <span
                class="badge"
                [class.badge-success]="usuario.status"
                [class.badge-danger]="!usuario.status"
              >
                <i
                  [class]="
                    usuario.status ? 'pi pi-check-circle' : 'pi pi-times-circle'
                  "
                ></i>
                {{ usuario.status ? "Activo" : "Inactivo" }}
              </span>
            </div>

            <div class="info-item">
              <label class="info-label">
                <i class="pi pi-id-card" style="color: #9c27b0"></i>
                ID de Usuario
              </label>
              <p class="info-value info-id">{{ usuario.uid }}</p>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Asignaciones -->
          <h3 class="section-title">
            <i class="pi pi-sitemap" style="color: #ff9800"></i>
            Asignaciones
          </h3>

          <div class="asignaciones-grid">
            <div class="asignacion-box rol-box">
              <div class="asignacion-header">
                <i class="pi pi-shield"></i>
                <span>Rol</span>
              </div>
              <p class="asignacion-value" *ngIf="usuario.rol">
                {{ usuario.rol.nombre }}
              </p>
              <p
                class="asignacion-description"
                *ngIf="usuario.rol && usuario.rol.descripcion"
              >
                {{ usuario.rol.descripcion }}
              </p>
            </div>

            <div class="asignacion-box area-box">
              <div class="asignacion-header">
                <i class="pi pi-building"></i>
                <span>Área</span>
              </div>
              <p class="asignacion-value" *ngIf="usuario.area">
                {{ usuario.area.nombre }}
              </p>
              <p
                class="asignacion-description"
                *ngIf="usuario.area && usuario.area.descripcion"
              >
                {{ usuario.area.descripcion }}
              </p>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Fechas -->
          <div class="fechas-grid">
            <div class="fecha-item">
              <label class="info-label">
                <i class="pi pi-calendar-plus" style="color: #00bcd4"></i>
                Fecha de Creación
              </label>
              <p class="info-value">
                {{ usuario.fecha_creacion | date : "dd/MM/yyyy HH:mm" }}
              </p>
              <span class="time-ago">
                ({{ usuario.fecha_creacion | timeAgo }})
              </span>
            </div>

            <div class="fecha-item">
              <label class="info-label">
                <i class="pi pi-refresh" style="color: #673ab7"></i>
                Última Actualización
              </label>
              <p class="info-value">
                {{ usuario.fecha_actualizacion | date : "dd/MM/yyyy HH:mm" }}
              </p>
              <span class="time-ago">
                ({{ usuario.fecha_actualizacion | timeAgo }})
              </span>
            </div>
          </div>
        </div>

        <!-- Tab Content: Estadísticas -->
        <div class="tab-content" *ngIf="activeTabIndex === 1">
          <!-- Loading Estadísticas -->
          <div *ngIf="cargandoEstadisticas" class="loading-stats">
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
            <div class="skeleton-stat"></div>
          </div>

          <!-- Estadísticas -->
          <div *ngIf="!cargandoEstadisticas && estadisticas" class="stats-grid">
            <div class="stat-card stat-blue">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Total Peticiones</p>
                  <p class="stat-value">
                    {{ estadisticas.totalPeticiones || 0 }}
                  </p>
                </div>
                <i class="pi pi-list stat-icon"></i>
              </div>
            </div>

            <div class="stat-card stat-green">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Resueltas</p>
                  <p class="stat-value">
                    {{ estadisticas.peticionesResueltas || 0 }}
                  </p>
                </div>
                <i class="pi pi-check-circle stat-icon"></i>
              </div>
            </div>

            <div class="stat-card stat-orange">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Pendientes</p>
                  <p class="stat-value">
                    {{ estadisticas.peticionesPendientes || 0 }}
                  </p>
                </div>
                <i class="pi pi-clock stat-icon"></i>
              </div>
            </div>

            <div class="stat-card stat-red">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Vencidas</p>
                  <p class="stat-value">
                    {{ estadisticas.peticionesVencidas || 0 }}
                  </p>
                </div>
                <i class="pi pi-exclamation-triangle stat-icon"></i>
              </div>
            </div>

            <div class="stat-card stat-purple">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Tasa de Resolución</p>
                  <p class="stat-value">{{ tasaResolucion }}%</p>
                </div>
                <i class="pi pi-chart-line stat-icon"></i>
              </div>
            </div>

            <div class="stat-card stat-indigo">
              <div class="stat-content">
                <div class="stat-info">
                  <p class="stat-label">Tiempo Promedio</p>
                  <p class="stat-value-small">
                    {{ estadisticas.tiempoPromedioResolucion || 0 }}h
                  </p>
                </div>
                <i class="pi pi-stopwatch stat-icon"></i>
              </div>
            </div>
          </div>

          <!-- Sin Estadísticas -->
          <div
            *ngIf="!cargandoEstadisticas && !estadisticas"
            class="empty-state"
          >
            <i class="pi pi-info-circle empty-icon"></i>
            <p class="empty-text">No hay estadísticas disponibles</p>
          </div>
        </div>
      </div>

      <!-- Usuario No Encontrado -->
      <div *ngIf="!usuario" class="error-state">
        <i class="pi pi-exclamation-triangle error-icon"></i>
        <p class="error-text">Usuario no encontrado</p>
        <button class="btn btn-primary" (click)="volver()">
          <i class="pi pi-arrow-left"></i>
          <span>Volver a Usuarios</span>
        </button>
      </div>
    </div>
  </div>
</div>
