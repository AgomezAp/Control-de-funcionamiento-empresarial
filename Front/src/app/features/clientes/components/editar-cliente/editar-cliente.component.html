<div class="editar-cliente-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <i class="pi pi-pencil"></i>
      <h2>{{ cargando ? "Cargando..." : "Editar Cliente" }}</h2>
    </div>
    <button class="btn-volver" (click)="volver()" type="button">
      <i class="pi pi-arrow-left"></i>
      Volver
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading">
    <div class="spinner"></div>
    <p>Cargando datos...</p>
  </div>

  <!-- Formulario -->
  <form
    *ngIf="!cargando && clienteForm"
    [formGroup]="clienteForm"
    (ngSubmit)="onSubmit()"
    class="form-container"
  >
    <div class="form-grid">
      <!-- Nombre -->
      <div class="form-group full">
        <label for="nombre">
          Nombre del Cliente <span class="required">*</span>
        </label>
        <input
          type="text"
          id="nombre"
          formControlName="nombre"
          placeholder="Ingrese el nombre del cliente"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('nombre')?.invalid &&
            clienteForm.get('nombre')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          El nombre es requerido (mínimo 3 caracteres)
        </small>
      </div>

      <!-- Cédula / NIT -->
      <div class="form-group full">
        <label for="cedula">
          Cédula / NIT / Documento de Identidad
        </label>
        <input
          type="text"
          id="cedula"
          formControlName="cedula"
          placeholder="Ej: 900123456-7, B12345678"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('cedula')?.invalid &&
            clienteForm.get('cedula')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          La cédula debe tener entre 5 y 50 caracteres (solo letras, números y guiones)
        </small>
      </div>

      <!-- Tipo de Persona -->
      <div class="form-group">
        <label for="tipo_persona">
          Tipo de Persona <span class="required">*</span>
        </label>
        <p-dropdown
          id="tipo_persona"
          formControlName="tipo_persona"
          [options]="tiposPersona"
          placeholder="Seleccionar tipo de persona"
          styleClass="w-full"
        ></p-dropdown>
        <small
          *ngIf="
            clienteForm.get('tipo_persona')?.invalid &&
            clienteForm.get('tipo_persona')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          Debe seleccionar un tipo de persona
        </small>
      </div>

      <!-- Teléfono -->
      <div class="form-group">
        <label for="telefono"> Teléfono </label>
        <input
          type="text"
          id="telefono"
          formControlName="telefono"
          placeholder="Ej: +57 310-1234567"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('telefono')?.invalid &&
            clienteForm.get('telefono')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          El teléfono no puede exceder 20 caracteres
        </small>
      </div>

      <!-- Correo Electrónico -->
      <div class="form-group">
        <label for="correo"> Correo Electrónico </label>
        <input
          type="email"
          id="correo"
          formControlName="correo"
          placeholder="Ej: contacto&#64;empresa.com"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('correo')?.invalid &&
            clienteForm.get('correo')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          Ingrese un correo electrónico válido
        </small>
      </div>

      <!-- Ciudad -->
      <div class="form-group">
        <label for="ciudad"> Ciudad </label>
        <input
          type="text"
          id="ciudad"
          formControlName="ciudad"
          placeholder="Ej: Bogotá"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('ciudad')?.invalid &&
            clienteForm.get('ciudad')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          La ciudad no puede exceder 100 caracteres
        </small>
      </div>

      <!-- Dirección -->
      <div class="form-group full">
        <label for="direccion"> Dirección </label>
        <textarea
          id="direccion"
          formControlName="direccion"
          placeholder="Ej: Calle 85 #15-20, Zona Rosa"
          rows="3"
          class="form-control"
        ></textarea>
        <small
          *ngIf="
            clienteForm.get('direccion')?.invalid &&
            clienteForm.get('direccion')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          La dirección no puede exceder 500 caracteres
        </small>
      </div>

      <!-- País -->
      <div class="form-group">
        <label for="pais"> País <span class="required">*</span> </label>
        <div class="select-wrapper">
          <select id="pais" formControlName="pais" class="form-control">
            <option value="" disabled>Seleccione un país</option>
            <option *ngFor="let pais of paises" [value]="pais.codigo">
              {{ pais.nombre }}
            </option>
          </select>
          <i class="pi pi-chevron-down select-icon"></i>
        </div>
        <small
          *ngIf="
            clienteForm.get('pais')?.invalid && clienteForm.get('pais')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          El país es requerido
        </small>
      </div>

      <!-- Tipo de Cliente -->
      <div class="form-group">
        <label for="tipo_cliente">
          Tipo de Cliente <span class="required">*</span>
        </label>
        <div class="select-wrapper">
          <select
            id="tipo_cliente"
            formControlName="tipo_cliente"
            class="form-control"
          >
            <option value="" disabled>Seleccione el tipo</option>
            <option *ngFor="let tipo of tiposCliente" [value]="tipo.value">
              {{ tipo.label }}
            </option>
          </select>
          <i class="pi pi-chevron-down select-icon"></i>
        </div>
        <small
          *ngIf="
            clienteForm.get('tipo_cliente')?.invalid &&
            clienteForm.get('tipo_cliente')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          El tipo de cliente es requerido
        </small>
      </div>

      <!-- Pautador -->
      <div class="form-group">
        <label for="pautador_id">
          Pautador <span class="required">*</span>
        </label>
        <div class="select-wrapper">
          <select
            id="pautador_id"
            formControlName="pautador_id"
            class="form-control"
          >
            <option value="" disabled>Seleccione un pautador</option>
            <option *ngFor="let pautador of pautadores" [value]="pautador.uid">
              {{ pautador.nombre_completo }}
            </option>
          </select>
          <i class="pi pi-chevron-down select-icon"></i>
        </div>
        <small
          *ngIf="
            clienteForm.get('pautador_id')?.invalid &&
            clienteForm.get('pautador_id')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          El pautador es requerido
        </small>
      </div>

      <!-- Diseñador -->
      <div class="form-group">
        <label for="disenador_id">
          Diseñador <span class="optional">(Opcional)</span>
        </label>
        <div class="select-wrapper">
          <select
            id="disenador_id"
            formControlName="disenador_id"
            class="form-control"
          >
            <option value="">Seleccione un diseñador</option>
            <option
              *ngFor="let disenador of disenadores"
              [value]="disenador.uid"
            >
              {{ disenador.nombre_completo }}
            </option>
          </select>
          <i class="pi pi-chevron-down select-icon"></i>
        </div>
      </div>

      <!-- Fecha de Inicio -->
      <div class="form-group">
        <label for="fecha_inicio">
          Fecha de Inicio <span class="required">*</span>
        </label>
        <input
          type="date"
          id="fecha_inicio"
          formControlName="fecha_inicio"
          class="form-control"
        />
        <small
          *ngIf="
            clienteForm.get('fecha_inicio')?.invalid &&
            clienteForm.get('fecha_inicio')?.touched
          "
          class="error"
        >
          <i class="pi pi-exclamation-circle"></i>
          La fecha de inicio es requerida
        </small>
      </div>

      <!-- Estado -->
      <div class="form-group">
        <label>Estado</label>
        <div class="toggle-container">
          <label class="toggle-switch">
            <input type="checkbox" formControlName="status" />
            <span class="toggle-slider"></span>
          </label>
          <span
            [class]="
              clienteForm.get('status')?.value
                ? 'status-active'
                : 'status-inactive'
            "
          >
            <i
              [class]="
                clienteForm.get('status')?.value
                  ? 'pi pi-check-circle'
                  : 'pi pi-times-circle'
              "
            ></i>
            {{ clienteForm.get("status")?.value ? "Activo" : "Inactivo" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn btn-cancel" (click)="volver()">
        <i class="pi pi-times"></i>
        Cancelar
      </button>
      <button
        type="submit"
        class="btn btn-save"
        [disabled]="clienteForm.invalid || guardando"
      >
        <i [class]="guardando ? 'pi pi-spin pi-spinner' : 'pi pi-save'"></i>
        {{ guardando ? "Guardando..." : "Guardar Cambios" }}
      </button>
    </div>
  </form>
</div>
