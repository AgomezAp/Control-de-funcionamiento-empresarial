<div class="clientes-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <i class="pi pi-users header-icon"></i>
      <h1 class="page-title">Clientes</h1>
    </div>
    <div class="header-right">
      <button
        *appHasRole="[RoleEnum.ADMIN, RoleEnum.DIRECTIVO, RoleEnum.LIDER]"
        class="btn btn-primary"
        (click)="crearCliente()"
        pTooltip="Crear un nuevo cliente"
        tooltipPosition="bottom"
      >
        <i class="pi pi-plus"></i>
        <span>Crear Cliente</span>
      </button>
    </div>
  </div>

  <!-- Loader -->
  <app-loader *ngIf="loading"></app-loader>

  <!-- Content -->
  <div class="content-wrapper" *ngIf="!loading">
    <!-- BUSCADOR -->
    <div class="search-section">
      <div class="search-container">
        <i class="pi pi-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          [(ngModel)]="globalFilterValue"
          (input)="onGlobalFilter($event)"
          placeholder="Buscar cliente..."
        />
        <button
          *ngIf="globalFilterValue"
          class="clear-search-btn"
          (click)="clearFilter()"
          pTooltip="Limpiar búsqueda"
          tooltipPosition="bottom"
        >
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-wrapper">
      <!-- Empty state -->
      <div *ngIf="filteredClientes.length === 0" class="empty-state">
        <app-empty-state
          icon="pi-users"
          title="No hay clientes"
          message="No se encontraron clientes registrados"
        ></app-empty-state>
      </div>

      <!-- Table -->
      <div *ngIf="filteredClientes.length > 0" class="table-scroll">
        <table class="clientes-table">
          <thead>
            <tr>
              <th class="col-id" (click)="sortBy('id')">
                <div class="header-content">
                  <span>ID</span>
                  <i
                    class="pi"
                    [ngClass]="{
                      'pi-sort-amount-down':
                        sortField === 'id' && sortOrder === 1,
                      'pi-sort-amount-up':
                        sortField === 'id' && sortOrder === -1,
                      'pi-sort': sortField !== 'id'
                    }"
                  ></i>
                </div>
              </th>
              <th class="col-nombre" (click)="sortBy('nombre')">
                <div class="header-content">
                  <span>Nombre</span>
                  <i
                    class="pi"
                    [ngClass]="{
                      'pi-sort-amount-down':
                        sortField === 'nombre' && sortOrder === 1,
                      'pi-sort-amount-up':
                        sortField === 'nombre' && sortOrder === -1,
                      'pi-sort': sortField !== 'nombre'
                    }"
                  ></i>
                </div>
              </th>
              <th class="col-cedula">Cédula/NIT</th>
              <th class="col-pais">País</th>
              <th class="col-tipo">Tipo de Cliente</th>
              <th class="col-acciones">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cliente of paginatedClientes" class="table-row">
              <td class="col-id">
                <span class="id-badge">{{ cliente.id }}</span>
              </td>
              <td class="col-nombre">
                <strong class="cliente-nombre">{{ cliente.nombre }}</strong>
              </td>
              <td class="col-cedula">
                <span class="cedula-text">{{ cliente.cedula || "N/A" }}</span>
              </td>
              <td class="col-pais">
                <span class="pais-badge">{{ cliente.pais }}</span>
              </td>
              <td class="col-tipo">
                <span
                  class="tipo-badge"
                  [ngClass]="{
                    'tipo-meta': cliente.tipo_cliente === 'Meta Ads',
                    'tipo-google': cliente.tipo_cliente === 'Google Ads',
                    'tipo-externo': cliente.tipo_cliente === 'Externo',
                    'tipo-otro': cliente.tipo_cliente === 'Otro'
                  }"
                >
                  {{ cliente.tipo_cliente }}
                </span>
              </td>
              <td class="col-acciones">
                <div class="actions-container">
                  <button
                    class="action-btn view-btn"
                    (click)="verDetalle(cliente.id)"
                    pTooltip="Ver detalle del cliente"
                    tooltipPosition="top"
                  >
                    <i class="pi pi-eye"></i>
                  </button>
                  <button
                    *appHasRole="[
                      RoleEnum.ADMIN,
                      RoleEnum.DIRECTIVO,
                      RoleEnum.LIDER
                    ]"
                    class="action-btn edit-btn"
                    (click)="editarCliente(cliente.id)"
                    pTooltip="Editar cliente"
                    tooltipPosition="top"
                  >
                    <i class="pi pi-pencil"></i>
                  </button>
                  <button
                    *appHasRole="[RoleEnum.ADMIN]"
                    class="action-btn delete-btn"
                    (click)="eliminarCliente(cliente)"
                    pTooltip="Eliminar cliente"
                    tooltipPosition="top"
                  >
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <div *ngIf="filteredClientes.length > 0" class="pagination">
        <div class="pagination-info">
          Mostrando {{ (currentPage - 1) * pageSize + 1 }} a
          {{ Math.min(currentPage * pageSize, filteredClientes.length) }} de
          {{ filteredClientes.length }} clientes
        </div>

        <div class="pagination-controls">
          <button
            class="pagination-btn"
            (click)="goToPage(1)"
            [disabled]="currentPage === 1"
            pTooltip="Primera página"
            tooltipPosition="top"
          >
            <i class="pi pi-angle-double-left"></i>
          </button>
          <button
            class="pagination-btn"
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            pTooltip="Página anterior"
            tooltipPosition="top"
          >
            <i class="pi pi-angle-left"></i>
          </button>

          <div class="pagination-pages">
            <button
              *ngFor="let page of visiblePages"
              class="pagination-page"
              [class.active]="page === currentPage"
              (click)="goToPage(page)"
              pTooltip="Página {{ page }}"
              tooltipPosition="top"
            >
              {{ page }}
            </button>
          </div>

          <button
            class="pagination-btn"
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
            pTooltip="Página siguiente"
            tooltipPosition="top"
          >
            <i class="pi pi-angle-right"></i>
          </button>
          <button
            class="pagination-btn"
            (click)="goToPage(totalPages)"
            [disabled]="currentPage === totalPages"
            pTooltip="Última página"
            tooltipPosition="top"
          >
            <i class="pi pi-angle-double-right"></i>
          </button>
        </div>

        <div class="page-size-selector">
          <label>Mostrar:</label>
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modales -->
<p-confirmDialog></p-confirmDialog>
<p-toast position="top-right"></p-toast>
