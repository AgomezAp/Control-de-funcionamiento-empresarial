<div class="historico-container">
  <div class="page-card">
    <!-- HEADER -->
    <div class="card-header">
      <div class="header-content">
        <div class="header-title">
          <i class="pi pi-history"></i>
          <h2>Histórico de Peticiones</h2>
        </div>
      </div>
    </div>

    <!-- LOADER -->
    <app-loader *ngIf="loading"></app-loader>

    <!-- TABLE -->
    <div class="table-wrapper" *ngIf="!loading">
      <!-- EMPTY STATE -->
      <div class="empty-state" *ngIf="!historico || historico.length === 0">
        <div class="empty-state-content">
          <i class="pi pi-history"></i>
          <h3>Sin histórico</h3>
          <p>No hay peticiones en el histórico</p>
        </div>
      </div>

      <!-- TABLE CONTENT -->
      <div class="table-scroll" *ngIf="historico && historico.length > 0">
        <table class="custom-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Categoría</th>
              <th>Costo</th>
              <th>Estado Final</th>
              <th>Fecha Resolución</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let peticion of paginatedData">
              <td>
                <span class="id-badge">#{{ peticion.id }}</span>
              </td>
              <td>
                <div class="client-cell">
                  <i class="pi pi-user"></i>
                  <span>{{ peticion.cliente?.nombre }}</span>
                </div>
              </td>
              <td>
                <span class="category-badge">{{
                  peticion.categoria?.nombre
                }}</span>
              </td>
              <td>
                <span class="cost-value">{{
                  peticion.costo | currencyCop
                }}</span>
              </td>
              <td>
                <span
                  class="status-badge"
                  [ngClass]="{
                    'status-success': peticion.estado === 'Resuelta',
                    'status-danger': peticion.estado !== 'Resuelta'
                  }"
                >
                  {{ peticion.estado }}
                </span>
              </td>
              <td>
                <span class="date-cell">{{
                  peticion.fecha_resolucion | timeAgo
                }}</span>
              </td>
              <td>
                <div class="actions-cell">
                  <button
                    class="action-btn btn-view"
                    (click)="
                      verDetalle(peticion.peticion_id_original || peticion.id)
                    "
                    title="Ver detalle"
                  >
                    <i class="pi pi-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- PAGINATION -->
      <div class="pagination" *ngIf="historico && historico.length > 0">
        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="goToPage(1)"
        >
          <i class="pi pi-angle-double-left"></i>
        </button>
        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)"
        >
          <i class="pi pi-angle-left"></i>
        </button>

        <div class="pagination-pages">
          <button
            *ngFor="let page of visiblePages"
            class="pagination-page"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </div>

        <button
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)"
        >
          <i class="pi pi-angle-right"></i>
        </button>
        <button
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(totalPages)"
        >
          <i class="pi pi-angle-double-right"></i>
        </button>

        <span class="pagination-info">
          Página {{ currentPage }} de {{ totalPages }} ({{
            historico.length
          }}
          registros)
        </span>
      </div>
    </div>
  </div>
</div>
